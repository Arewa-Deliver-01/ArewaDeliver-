<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Customer Wallet — ArewaDeliver</title>
<link rel="stylesheet" href="style.css" />
<style>
/* small page-specific adjustments (Theme A) */
.page { max-width:720px; margin:28px auto; padding:18px; }
.card { background:#fff; border-radius:14px; padding:18px; box-shadow:0 8px 26px rgba(0,0,0,0.06); }
.balance { background:linear-gradient(135deg,#00b894,#008f72); color:#fff; padding:18px; border-radius:12px; text-align:center; }
.actions { display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; }
.txn .meta { font-size:0.95rem; color:#333; }
.smallmuted { color:#666; font-size:0.9rem; }
</style>
</head>
<body>
<header><h1 class="logo">ArewaDeliver</h1><nav><a href="index.html">Home</a><a href="customer_dashboard.html">Dashboard</a><a href="wallet.html">Wallet</a></nav></header>

<main class="page">
  <h2>Customer Wallet</h2>

  <div class="card">
    <div class="balance">
      <div class="smallmuted">Available Balance</div>
      <div id="bal" style="font-size:2rem;font-weight:700">₦0</div>
      <div class="smallmuted">Wallet ID: <span id="wid">—</span></div>
    </div>

    <div class="actions">
      <button id="topupBtn" class="btn">Top up</button>
      <button id="payBtn" class="btn outline">Pay for Order (Sim)</button>
      <button id="historyBtn" class="btn outline">Clear Demo Data</button>
    </div>

    <section style="margin-top:14px">
      <h3>Transactions</h3>
      <div id="txs"></div>
    </section>
  </div>
</main>

<script>
/*
Customer wallet demo:
- Top-up adds credit
- Pay for Order simulates a customer paying an order amount.
  Payment flow (demo): customer balance decreases by amount; platform wallet receives full amount,
  then when vendor marks delivered (sim in vendor flow) the commission split occurs.
  For the purpose of this demo, when customer pays we record a transaction and increase platform reserve.
*/
(function(){
  const USERS_KEY = 'arewa_users';
  const PLATFORM_KEY = 'arewa_platform'; // platform wallet storage (demo)
  const session = JSON.parse(localStorage.getItem('arewa_session')||'null');
  const users = JSON.parse(localStorage.getItem(USERS_KEY)||'[]');

  // platform wallet object in localStorage (demo)
  function ensurePlatform(){ 
    const p = JSON.parse(localStorage.getItem(PLATFORM_KEY)||'null');
    if(!p){ localStorage.setItem(PLATFORM_KEY, JSON.stringify({wallet:{balance:0,transactions:[]}})); }
  }
  ensurePlatform();

  // find current customer (by session) or use first customer
  let me = users.find(u=>u.id===session?.user_id) || users.find(u=>u.role==='customer') || null;
  if(!me){
    // create demo customer
    me = { id: Date.now(), name:'DemoCustomer', email:'cust@demo', role:'customer', wallet:{balance:3000, transactions:[]}};
    users.push(me);
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
  }

  const balEl = document.getElementById('bal');
  const wid = document.getElementById('wid');
  const txsEl = document.getElementById('txs');

  function formatN(n){ return '₦'+Number(n).toLocaleString(); }

  function render(){
    balEl.textContent = formatN(me.wallet.balance || 0);
    wid.textContent = me.id;
    const tx = me.wallet.transactions || [];
    txsEl.innerHTML = tx.length ? tx.map(t=>`<div class="txn card" style="margin-bottom:8px;padding:10px"><div class="meta"><strong>${t.title}</strong><div class="smallmuted">${new Date(t.date).toLocaleString()}</div></div><div style="text-align:right">${t.type==='credit'? '+'+t.amount : '-'+t.amount}</div></div>`).join('') : '<p class="smallmuted">No transactions yet</p>';
  }
  render();

  // top-up (demo)
  document.getElementById('topupBtn').addEventListener('click', ()=>{
    const amt = Number(prompt('Top-up amount (₦)','1000')) || 0;
    if(amt<=0){ alert('Invalid amount'); return; }
    me.wallet.balance = Number(me.wallet.balance||0) + amt;
    me.wallet.transactions = me.wallet.transactions || [];
    me.wallet.transactions.unshift({title:'Top-up', amount: formatN(amt), type:'credit', date:new Date().toISOString()});
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
    render(); alert('Top-up successful (demo)');
  });

  // pay for order (demo)
  document.getElementById('payBtn').addEventListener('click', ()=>{
    const amt = Number(prompt('Order amount (₦)','1500')) || 0;
    if(amt<=0) return alert('invalid amount');
    if((me.wallet.balance||0) < amt) return alert('Insufficient wallet balance — top up first');
    // deduct from customer
    me.wallet.balance -= amt;
    me.wallet.transactions.unshift({title:'Order Payment', amount: formatN(amt), type:'debit', date:new Date().toISOString()});
    // record platform reserve (platform will later split when vendor completes)
    const platform = JSON.parse(localStorage.getItem(PLATFORM_KEY)||'{"wallet":{balance:0,transactions:[]}}');
    platform.wallet.balance = Number(platform.wallet.balance||0) + amt;
    platform.wallet.transactions.unshift({title:`Received from ${me.email}`, amount: formatN(amt), type:'credit', date:new Date().toISOString()});
    localStorage.setItem(PLATFORM_KEY, JSON.stringify(platform));
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
    render();
    alert('Order paid (demo). Platform holds funds until completion.');
  });

  // clear demo (careful)
  document.getElementById('historyBtn').addEventListener('click', ()=>{
    if(!confirm('Clear demo users and platform wallet?')) return;
    localStorage.removeItem(USERS_KEY);
    localStorage.removeItem(PLATFORM_KEY);
    alert('Demo data cleared. Reload page.');
    location.reload();
  });

})();
</script>
</body>
  </html>
