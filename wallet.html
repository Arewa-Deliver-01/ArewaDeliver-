<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wallet — ArewaDeliver</title>
<link rel="stylesheet" href="style.css" />
<style>
/* Wallet page specific overrides */
.wallet-page {
  max-width:720px;
  margin:28px auto;
  padding:18px;
}
.wallet-top {
  display:flex;
  gap:18px;
  align-items:center;
  flex-wrap:wrap;
}
.balance-card {
  flex:1 1 320px;
  border-radius:18px;
  padding:22px;
  color:#fff;
  background:linear-gradient(135deg,#00b894,#008f72);
  box-shadow:0 10px 28px rgba(0,0,0,0.12);
  transform-origin:center;
  transition: transform .28s ease;
}
.balance-card:hover { transform: translateY(-6px); }
.wallet-quick {
  flex:0 0 260px;
  background:#fff;
  border-radius:12px;
  padding:14px;
  box-shadow:0 6px 20px rgba(0,0,0,0.06);
}
.balance-amount { font-size:2.4rem; font-weight:700; margin:6px 0; }
.small { opacity:0.85; font-size:0.95rem; }
.actions { display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
.action-btn { padding:10px 14px; border-radius:999px; border:none; cursor:pointer; font-weight:700; transition: transform .18s ease; }
.action-btn:hover { transform: scale(1.04); }

/* transactions */
.txn-list { margin-top:18px; }
.txn { display:flex; justify-content:space-between; align-items:center; gap:10px; padding:12px; border-radius:12px; background:#fafafa; box-shadow:0 2px 8px rgba(0,0,0,0.03); margin-bottom:10px; }
.txn .meta { display:flex; gap:10px; flex-direction:column; }
.amt.credit { color:#00b894; font-weight:700; }
.amt.debit { color:#d63031; font-weight:700; }

/* topup modal (simple) */
.modal-back { position:fixed; inset:0; background:rgba(0,0,0,0.45); display:flex; align-items:center; justify-content:center; z-index:60; }
.modal { width:360px; background:#fff; padding:18px; border-radius:12px; box-shadow:0 18px 40px rgba(0,0,0,0.25); }
.input-inline { display:flex; gap:8px; align-items:center; }
.switch { display:flex; align-items:center; gap:8px; justify-content:space-between; margin-top:12px; }

/* Light / Dark toggle */
.theme-toggle { cursor:pointer; padding:8px 12px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); background:#fff; }

@media (max-width:720px){
  .wallet-top { flex-direction:column; }
  .wallet-quick { width:100%; }
}
</style>
</head>
<body>
<header>
  <h1 class="logo">ArewaDeliver</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="profile.html">Profile</a>
    <a href="wallet.html">Wallet</a>
    <a href="logout.html" id="logoutLink">Logout</a>
  </nav>
</header>

<main class="wallet-page">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2>Wallet</h2>
    <div style="display:flex;gap:10px;align-items:center">
      <button id="toggleTheme" class="theme-toggle">Toggle Theme</button>
    </div>
  </div>

  <div class="wallet-top" style="margin-top:14px">
    <div class="balance-card" id="balanceCard">
      <div class="small">Available Balance</div>
      <div class="balance-amount" id="balanceAmount">₦0</div>
      <div class="small">Wallet ID: <span id="walletId">—</span></div>
    </div>

    <div class="wallet-quick">
      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="small">Quick Actions</div>
        <div class="actions">
          <button class="action-btn" id="btnTopUp" style="background:#00b894;color:#fff">Top up</button>
          <button class="action-btn" id="btnWithdraw" style="background:#fff;border:2px solid #00b894;color:#00b894">Withdraw</button>
          <button class="action-btn" id="btnTransfer" style="background:#222;color:#fff">Transfer</button>
        </div>
        <div class="switch">
          <div class="small">Transactions</div>
          <div><small id="txCount" class="muted">0</small></div>
        </div>
      </div>
    </div>
  </div>

  <section class="txn-list">
    <h3>Recent Transactions</h3>
    <div id="txList"></div>
  </section>
</main>

<!-- Top-up modal -->
<div id="modal" style="display:none" aria-hidden="true"></div>

<script>
/* Wallet page logic — localStorage demo (ready for backend swap) */
(function(){
  // helpers
  function qs(sel){ return document.querySelector(sel); }
  function qsa(sel){ return Array.from(document.querySelectorAll(sel)); }

  // session
  const session = JSON.parse(localStorage.getItem('arewa_session')||'null');
  if(!session){ /* not logged in — send to login */ /*allow view?*/ }
  const users = JSON.parse(localStorage.getItem('arewa_users')||'[]');
  const user = users.find(u=>u.id===session?.user_id) || users.find(u=>u.email===session?.email) || null;

  // Ensure user exists in demo storage
  if(!user){
    // create demo user for wallet view
    const demo = { id: 9999999, name:'Demo User', email: session?.email||'demo@arewa', role:'customer', wallet:{balance:5000, transactions:[]}};
    users.push(demo);
    localStorage.setItem('arewa_users', JSON.stringify(users));
    // set session if missing
    if(!session) localStorage.setItem('arewa_session', JSON.stringify({user_id:demo.id, email:demo.email, role:demo.role, name:demo.name}));
  }

  const me = users.find(u => u.id === (session?.user_id || (users[users.length-1] && users[users.length-1].id)));
  if(!me.wallet) me.wallet = {balance:0, transactions:[]};

  // render
  const balElem = qs('#balanceAmount');
  const idElem = qs('#walletId');
  const txList = qs('#txList');
  const txCount = qs('#txCount');

  function formatN(n){ return '₦'+Number(n).toLocaleString(); }

  function render(){
    balElem.textContent = formatN(me.wallet.balance || 0);
    idElem.textContent = me.id || '—';
    const tx = me.wallet.transactions || [];
    txCount.textContent = tx.length;
    if(tx.length===0) {
      txList.innerHTML = '<p class="muted">No transactions yet.</p>';
      return;
    }
    txList.innerHTML = tx.map(t=>{
      const amtCls = t.type==='credit' ? 'amt credit' : 'amt debit';
      return `<div class="txn">
        <div class="meta">
          <strong>${t.title}</strong>
          <small class="muted">${new Date(t.date).toLocaleString()}</small>
        </div>
        <div class="${amtCls}">${t.type==='credit' ? '+'+t.amount : '-'+t.amount}</div>
      </div>`;
    }).join('');
  }

  render();

  // modal helper
  function showModal(html){
    const modal = qs('#modal');
    modal.innerHTML = `<div class="modal-back"><div class="modal">${html}</div></div>`;
    modal.style.display = 'block';
    modal.querySelector('.closeModal')?.addEventListener('click', hideModal);
  }
  function hideModal(){ qs('#modal').style.display='none'; qs('#modal').innerHTML=''; }

  // Top up flow
  qs('#btnTopUp').addEventListener('click', ()=>{
    showModal(`
      <h3>Top up Wallet</h3>
      <div style="margin-top:10px">
        <label>Amount (₦)</label>
        <input id="topAmount" type="number" value="1000" />
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
          <button class="btn outline closeModal">Cancel</button>
          <button class="btn" id="confirmTop">Pay & Top-up</button>
        </div>
      </div>
    `);
    qs('#modal .modal').querySelector('#confirmTop').addEventListener('click', ()=>{
      const amt = Number(qs('#modal #topAmount').value) || 0;
      if(amt <= 0) { alert('Enter a valid amount'); return; }
      me.wallet.balance = Number(me.wallet.balance || 0) + amt;
      me.wallet.transactions = me.wallet.transactions || [];
      me.wallet.transactions.unshift({title:'Wallet Top-up', amount: formatN(amt), type:'credit', date: new Date().toISOString()});
      localStorage.setItem('arewa_users', JSON.stringify(users));
      render();
      hideModal();
      alert('Top-up successful');
    });
    qs('#modal .closeModal')?.addEventListener('click', hideModal);
  });

  // Withdraw
  qs('#btnWithdraw').addEventListener('click', ()=>{
    showModal(`
      <h3>Withdraw</h3>
      <p class="muted">Withdrawals require ArewaPay/OPay integration. Demo will simulate deduction.</p>
      <label>Amount (₦)</label><input id="wdAmount" type="number" value="500" />
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
        <button class="btn outline closeModal">Cancel</button>
        <button class="btn" id="confirmWD">Withdraw</button>
      </div>
    `);
    qs('#modal .modal').querySelector('#confirmWD').addEventListener('click', ()=>{
      const amt = Number(qs('#modal #wdAmount').value) || 0;
      if(amt <= 0){ alert('Enter valid amount'); return; }
      if((me.wallet.balance || 0) < amt){ alert('Insufficient balance'); return; }
      me.wallet.balance -= amt;
      me.wallet.transactions.unshift({title:'Withdraw', amount: formatN(amt), type:'debit', date: new Date().toISOString()});
      localStorage.setItem('arewa_users', JSON.stringify(users));
      render(); hideModal(); alert('Withdraw simulated (demo).');
    });
  });

  // Transfer (simple)
  qs('#btnTransfer').addEventListener('click', ()=>{
    showModal(`
      <h3>Transfer to another user</h3>
      <label>Recipient email</label><input id="toEmail" type="email" />
      <label>Amount (₦)</label><input id="trAmount" type="number" value="200" />
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
        <button class="btn outline closeModal">Cancel</button>
        <button class="btn" id="doTransfer">Send</button>
      </div>
    `);
    qs('#modal .modal').querySelector('#doTransfer').addEventListener('click', ()=>{
      const to = qs('#modal #toEmail').value.trim().toLowerCase();
      const amt = Number(qs('#modal #trAmount').value) || 0;
      if(!to || amt<=0){ alert('Enter details'); return; }
      const recip = users.find(u=>u.email===to) || null;
      if(!recip){ alert('Recipient not found'); return; }
      if((me.wallet.balance || 0) < amt){ alert('Insufficient balance'); return; }
      me.wallet.balance -= amt;
      recip.wallet = recip.wallet || {balance:0, transactions:[]};
      recip.wallet.balance = Number(recip.wallet.balance || 0) + amt;
      me.wallet.transactions.unshift({title:`Transfer to ${recip.name}`, amount: formatN(amt), type:'debit', date: new Date().toISOString()});
      recip.wallet.transactions.unshift({title:`Received from ${me.name}`, amount: formatN(amt), type:'credit', date: new Date().toISOString()});
      localStorage.setItem('arewa_users', JSON.stringify(users));
      render(); hideModal(); alert('Transfer successful (demo).');
    });
  });

  // theme toggle (simple)
  const themeBtn = qs('#toggleTheme');
  function setTheme(dark){
    if(dark) document.documentElement.style.setProperty('background','#0f1720');
    else document.documentElement.style.removeProperty('background');
    localStorage.setItem('arewa_theme', dark ? 'dark' : 'light');
  }
  const savedTheme = localStorage.getItem('arewa_theme') || 'light';
  setTheme(savedTheme === 'dark');
  themeBtn.addEventListener('click', ()=>{ setTheme(localStorage.getItem('arewa_theme')!=='dark'); });

  // logout
  qs('#logoutLink').addEventListener('click', ()=>{ localStorage.removeItem('arewa_session'); location.href='index.html'; });

})();
</script>
</body>
</html>
