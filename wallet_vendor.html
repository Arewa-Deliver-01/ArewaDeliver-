<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vendor Wallet — ArewaDeliver</title>
<link rel="stylesheet" href="style.css" />
<style>
.page{max-width:720px;margin:28px auto;padding:18px;}
.card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 8px 26px rgba(0,0,0,0.06);}
.balance { background: linear-gradient(135deg,#00b894,#008f72); color:#fff; padding:16px;border-radius:10px; text-align:center; }
.row{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
.smallmuted{color:#666}
</style>
</head>
<body>
<header><h1 class="logo">ArewaDeliver</h1><nav><a href="vendor_dashboard.html">Dashboard</a><a href="wallet_vendor.html">Wallet</a><a href="store_profile.html">Store</a></nav></header>

<main class="page">
  <h2>Vendor Wallet</h2>

  <div class="card">
    <div class="balance">
      <div class="smallmuted">Available Balance (Vendor)</div>
      <div id="vBal" style="font-size:2rem;font-weight:700">₦0</div>
      <div class="smallmuted">Vendor ID: <span id="vId">—</span></div>
    </div>

    <div class="row">
      <button id="withdrawBtn" class="btn outline">Withdraw</button>
      <button id="simulateOrder" class="btn">Simulate Completed Order</button>
      <button id="clearDemo" class="btn outline">Clear Demo</button>
    </div>

    <section style="margin-top:14px">
      <h3>Transactions & Income</h3>
      <div id="vTxs"></div>
    </section>

    <section style="margin-top:12px">
      <h3>Platform Earnings (Demo)</h3>
      <div id="platInfo" class="smallmuted"></div>
    </section>
  </div>
</main>

<script>
/*
Vendor wallet logic (demo):
- When a completed order is processed (simulate), platform wallet releases funds:
   Order amount is in platform reserve (from customer payment).
   Vendor receives: amount - commission (5%) - notification fee (₦50).
   Platform wallet increases by commission + notification fee.
- Commission percent and notification fee are constants here.
*/
(function(){
  const USERS_KEY='arewa_users', PLATFORM_KEY='arewa_platform';
  const COMMISSION = 0.05; // 5%
  const NOTIF_FEE = 50; // ₦50 per notification
  const session = JSON.parse(localStorage.getItem('arewa_session')||'null');
  let users = JSON.parse(localStorage.getItem(USERS_KEY)||'[]');
  if(!users.length){
    // seed a vendor and a customer
    const v = { id: 2001, name:'DemoVendor', email:'vendor@demo', role:'vendor', vendor_business:'Demo Store', wallet:{balance:0,transactions:[]} };
    const c = { id: 1001, name:'DemoCustomer', email:'cust@demo', role:'customer', wallet:{balance:5000,transactions:[]} };
    users = [c, v];
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
  }
  // ensure platform storage
  const ensurePlatform = ()=>{ if(!localStorage.getItem(PLATFORM_KEY)) localStorage.setItem(PLATFORM_KEY, JSON.stringify({wallet:{balance:0,transactions:[]}})); };
  ensurePlatform();

  const me = users.find(u=>u.role==='vendor') || users[0];
  const vBalEl = document.getElementById('vBal');
  const vIdEl = document.getElementById('vId');
  const vTxs = document.getElementById('vTxs');
  const platInfo = document.getElementById('platInfo');

  function fmt(n){ return '₦'+Number(n).toLocaleString(); }
  function render(){
    vBalEl.textContent = fmt(me.wallet.balance || 0);
    vIdEl.textContent = me.id;
    const tx = me.wallet.transactions || [];
    vTxs.innerHTML = tx.length ? tx.map(t=>`<div class="txn card" style="margin-bottom:8px;padding:10px"><div><strong>${t.title}</strong><div class="smallmuted">${new Date(t.date).toLocaleString()}</div></div><div style="text-align:right">${t.type==='credit'? '+'+t.amount : '-'+t.amount}</div></div>`).join('') : '<p class="smallmuted">No transactions yet</p>';
    const platform = JSON.parse(localStorage.getItem(PLATFORM_KEY)||'{"wallet":{balance:0}}');
    platInfo.innerHTML = `Platform wallet balance: <strong>${fmt(platform.wallet.balance||0)}</strong>`;
  }
  render();

  // simulate completed order processing
  document.getElementById('simulateOrder').addEventListener('click', ()=>{
    // get platform reserve
    const platform = JSON.parse(localStorage.getItem(PLATFORM_KEY)||'{"wallet":{balance:0,transactions:[]}}');
    // ask amount (for demo) - ideally this amount would come from platform reserve recorded earlier when customer paid
    const amount = Number(prompt('Enter order amount (₦) to release to vendor','2000')) || 0;
    if(amount<=0) return alert('Invalid amount');
    // check platform reserve
    if((platform.wallet.balance||0) < amount){
      // If not enough in reserve, optionally allow "advance" for demo
      if(!confirm('Platform reserve has insufficient funds. Add the amount to platform reserve for demo?')) return;
      platform.wallet.balance = (platform.wallet.balance||0) + amount;
    }

    // compute commission & notification fee
    const commission = Math.round(amount * COMMISSION);
    const notif = NOTIF_FEE;
    const toVendor = amount - commission - notif;

    // adjust vendor wallet
    me.wallet.balance = Number(me.wallet.balance || 0) + toVendor;
    me.wallet.transactions = me.wallet.transactions || [];
    me.wallet.transactions.unshift({title:`Order settled (${String(amount)})`, amount: fmt(toVendor), type:'credit', date: new Date().toISOString()});

    // platform takes commission + notif
    platform.wallet.balance = Number(platform.wallet.balance || 0) - amount; // release amount
    platform.wallet.transactions = platform.wallet.transactions || [];
    // platform receives commission and notification fee into platform revenue (we can store separately)
    // For simplicity we will add them back to platform.wallet.balance
    platform.wallet.balance = Number(platform.wallet.balance || 0) + commission + notif;
    platform.wallet.transactions.unshift({title:`Commission ${commission} + Notif ${notif}`, amount: fmt(commission+notif), type:'credit', date:new Date().toISOString()});

    // persist
    localStorage.setItem(PLATFORM_KEY, JSON.stringify(platform));
    users = users.map(u=> u.id===me.id ? me : u);
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
    render();
    alert(`Vendor received ${fmt(toVendor)} (Commission ${fmt(commission)} + Notif ${fmt(notif)} applied).`);
  });

  document.getElementById('withdrawBtn').addEventListener('click', ()=>{
    const w = Number(prompt('Withdraw amount (₦)','500')) || 0;
    if(w<=0) return;
    if((me.wallet.balance||0) < w) return alert('Insufficient vendor balance');
    me.wallet.balance -= w;
    me.wallet.transactions.unshift({title:'Withdraw', amount: `-${fmt(w)}`, type:'debit', date: new Date().toISOString()});
    users = users.map(u=> u.id===me.id ? me : u);
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
    render(); alert('Withdraw simulated (demo).');
  });

  document.getElementById('clearDemo').addEventListener('click', ()=>{
    if(!confirm('Clear demo users & platform?')) return;
    localStorage.removeItem(USERS_KEY);
    localStorage.removeItem(PLATFORM_KEY);
    alert('Cleared. Reload page.'); location.reload();
  });

})();
</script>
</body>
</html>
